// Code generated by Wire. DO NOT EDIT.

//go:generate go run github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package ioc

import (
	"github.com/Duke1616/ecmdb/api/proto/gen/ealert/notification/v1"
	"github.com/Duke1616/ecmdb/api/proto/gen/ealert/template/v1"
	"github.com/Duke1616/ecmdb/internal/attribute"
	"github.com/Duke1616/ecmdb/internal/codebook"
	"github.com/Duke1616/ecmdb/internal/dataio"
	"github.com/Duke1616/ecmdb/internal/department"
	"github.com/Duke1616/ecmdb/internal/discovery"
	"github.com/Duke1616/ecmdb/internal/endpoint"
	"github.com/Duke1616/ecmdb/internal/engine"
	"github.com/Duke1616/ecmdb/internal/event"
	"github.com/Duke1616/ecmdb/internal/menu"
	"github.com/Duke1616/ecmdb/internal/model"
	"github.com/Duke1616/ecmdb/internal/order"
	"github.com/Duke1616/ecmdb/internal/permission"
	"github.com/Duke1616/ecmdb/internal/pkg/middleware"
	"github.com/Duke1616/ecmdb/internal/pkg/notification/sender"
	"github.com/Duke1616/ecmdb/internal/policy"
	"github.com/Duke1616/ecmdb/internal/relation"
	"github.com/Duke1616/ecmdb/internal/resource"
	"github.com/Duke1616/ecmdb/internal/role"
	"github.com/Duke1616/ecmdb/internal/rota"
	"github.com/Duke1616/ecmdb/internal/runner"
	"github.com/Duke1616/ecmdb/internal/strategy"
	"github.com/Duke1616/ecmdb/internal/task"
	"github.com/Duke1616/ecmdb/internal/template"
	"github.com/Duke1616/ecmdb/internal/terminal"
	"github.com/Duke1616/ecmdb/internal/tools"
	"github.com/Duke1616/ecmdb/internal/user"
	"github.com/Duke1616/ecmdb/internal/worker"
	"github.com/Duke1616/ecmdb/internal/workflow"
	"github.com/Duke1616/ecmdb/pkg/storage"
	grpc2 "github.com/Duke1616/ework-runner/pkg/grpc"
	"github.com/Duke1616/ework-runner/pkg/grpc/registry"
	"github.com/google/wire"
	"github.com/spf13/viper"
	"google.golang.org/grpc"
	"time"
)

import (
	_ "github.com/go-sql-driver/mysql"
)

// Injectors from wire.go:

func InitApp() (*App, error) {
	cmdable := InitRedis()
	provider := InitSession(cmdable)
	db := InitMySQLDB()
	syncedEnforcer := InitCasbin(db)
	module, err := policy.InitModule(syncedEnforcer)
	if err != nil {
		return nil, err
	}
	service := module.Svc
	checkPolicyMiddlewareBuilder := middleware.NewCheckPolicyMiddlewareBuilder(service, provider)
	v := InitGinMiddlewares()
	mongo := InitMongoDB()
	relationModule, err := relation.InitModule(mongo)
	if err != nil {
		return nil, err
	}
	mq := InitMQ()
	attributeModule, err := attribute.InitModule(mongo, mq)
	if err != nil {
		return nil, err
	}
	cryptoRegistry := InitModuleCrypto()
	resourceModule, err := resource.InitModule(mongo, attributeModule, relationModule, mq, cryptoRegistry)
	if err != nil {
		return nil, err
	}
	modelModule, err := model.InitModule(mongo, relationModule, attributeModule, resourceModule)
	if err != nil {
		return nil, err
	}
	handler := modelModule.Hdl
	webHandler := attributeModule.Hdl
	handler2 := resourceModule.Hdl
	relationModelHandler := relationModule.RMHdl
	relationResourceHandler := relationModule.RRHdl
	relationTypeHandler := relationModule.RTHdl
	client := InitRedisSearch()
	config := InitLdapConfig()
	departmentModule, err := department.InitModule(mongo)
	if err != nil {
		return nil, err
	}
	userModule, err := user.InitModule(mongo, client, config, module, departmentModule, provider, cryptoRegistry)
	if err != nil {
		return nil, err
	}
	handler3 := userModule.Hdl
	workwxApp := InitWorkWx()
	templateModule, err := template.InitModule(mq, mongo, workwxApp)
	if err != nil {
		return nil, err
	}
	handler4 := templateModule.Hdl
	strategyModule, err := strategy.InitModule(templateModule)
	if err != nil {
		return nil, err
	}
	handler5 := strategyModule.Hdl
	codebookModule, err := codebook.InitModule(mongo)
	if err != nil {
		return nil, err
	}
	handler6 := codebookModule.Hdl
	engineModule, err := engine.InitModule(db)
	if err != nil {
		return nil, err
	}
	workflowModule, err := workflow.InitModule(mongo, engineModule)
	if err != nil {
		return nil, err
	}
	runnerModule, err := runner.InitModule(mongo, workflowModule, codebookModule, cryptoRegistry)
	if err != nil {
		return nil, err
	}
	handler7 := runnerModule.Hdl
	larkClient := InitLarkClient()
	clientv3Client := InitEtcdClient()
	registry := InitRegistry(clientv3Client)
	clientConnInterface := InitEALERTGrpcClient(registry)
	notificationServiceClient := InitNotificationServiceClient(clientConnInterface)
	serviceService := workflowModule.Svc
	cardSelectorBuilder := newCardSelectorBuilder(larkClient, notificationServiceClient, serviceService)
	textSelectorBuilder := newTextSelectorBuilder(larkClient)
	channel := newChannel(cardSelectorBuilder, textSelectorBuilder)
	notificationSender := sender.NewSender(channel)
	orderModule, err := order.InitModule(mq, mongo, workflowModule, engineModule, templateModule, userModule, larkClient, notificationSender)
	if err != nil {
		return nil, err
	}
	handler8 := orderModule.Hdl
	handler9 := workflowModule.Hdl
	groupHandler := templateModule.GroupHdl
	handler10 := engineModule.Hdl
	workerModule, err := worker.InitModule(mq, clientv3Client)
	if err != nil {
		return nil, err
	}
	discoveryModule, err := discovery.InitModule(mongo)
	if err != nil {
		return nil, err
	}
	taskClientConn := InitTASKGrpcClient(registry)
	taskServiceClient := InitTaskServiceClient(taskClientConn)
	taskExecutionServiceClient := InitTaskExecutionServiceClient(taskClientConn)
	taskModule, err := task.InitModule(mq, mongo, orderModule, workflowModule, engineModule, codebookModule, workerModule, runnerModule, userModule, discoveryModule, larkClient, cryptoRegistry, notificationSender, taskServiceClient, taskExecutionServiceClient)
	if err != nil {
		return nil, err
	}
	handler11 := taskModule.Hdl
	handler12 := module.Hdl
	menuModule, err := menu.InitModule(mq, mongo)
	if err != nil {
		return nil, err
	}
	handler13 := menuModule.Hdl
	endpointModule, err := endpoint.InitModule(mongo)
	if err != nil {
		return nil, err
	}
	handler14 := endpointModule.Hdl
	roleModule, err := role.InitModule(mongo)
	if err != nil {
		return nil, err
	}
	handler15 := roleModule.Hdl
	permissionModule, err := permission.InitModule(mongo, mq, roleModule, menuModule, module)
	if err != nil {
		return nil, err
	}
	handler16 := permissionModule.Hdl
	handler17 := departmentModule.Hdl
	minioClient := InitMinioClient()
	s3Storage := storage.NewS3Storage(minioClient)
	handler18, err := tools.InitModule(s3Storage)
	if err != nil {
		return nil, err
	}
	handler19, err := terminal.InitModule(relationModule, resourceModule, attributeModule)
	if err != nil {
		return nil, err
	}
	rotaModule, err := rota.InitModule(mongo)
	if err != nil {
		return nil, err
	}
	handler20 := rotaModule.Hdl
	handler21 := discoveryModule.Hdl
	dataioModule, err := dataio.InitModule(attributeModule, resourceModule, s3Storage, modelModule)
	if err != nil {
		return nil, err
	}
	handler22 := dataioModule.Hdl
	checkLoginMiddlewareBuilder := middleware.NewCheckLoginMiddlewareBuilder(provider)
	component := InitWebServer(provider, checkPolicyMiddlewareBuilder, v, handler, webHandler, handler2, relationModelHandler, relationResourceHandler, relationTypeHandler, handler3, handler4, handler5, handler6, handler7, handler8, handler9, groupHandler, handler10, handler11, handler12, handler13, handler14, handler15, handler16, handler17, handler18, handler19, handler20, handler21, handler22, checkLoginMiddlewareBuilder)
	workOrderServer := orderModule.RpcServer
	policyServer := module.RpcServer
	endpointServer := endpointModule.RpcServer
	userServer := userModule.RpcServer
	rotaServer := rotaModule.RpcServer
	server := InitGrpcServer(registry, workOrderServer, policyServer, endpointServer, userServer, rotaServer)
	eventModule, err := event.InitModule(mq, db, engineModule, taskModule, orderModule, templateModule, userModule, workflowModule, notificationSender, departmentModule, larkClient, notificationServiceClient)
	if err != nil {
		return nil, err
	}
	processEvent := eventModule.Event
	startTaskJob := taskModule.StartTaskJob
	passProcessTaskJob := taskModule.PassProcessTaskJob
	taskExecutionSyncJob := taskModule.TaskExecutionSyncJob
	taskRecoveryJob := taskModule.TaskRecoveryJob
	v2 := initCronJobs(startTaskJob, passProcessTaskJob, taskExecutionSyncJob, taskRecoveryJob)
	service2 := endpointModule.Svc
	app := &App{
		Web:    component,
		Server: server,
		Event:  processEvent,
		Jobs:   v2,
		Svc:    service2,
	}
	return app, nil
}

// wire.go:

var BaseSet = wire.NewSet(InitMongoDB, InitMySQLDB, InitRedis, InitMinioClient, InitMQ,
	InitRedisSearch, InitEtcdClient, InitWorkWx, InitLarkClient, InitModuleCrypto, InitRegistry)

// InitEALERTGrpcClient 初始化 EALERT gRPC 客户端
func InitEALERTGrpcClient(reg registry.Registry) grpc.ClientConnInterface {
	var cfg grpc2.ClientConfig
	if err := viper.UnmarshalKey("grpc.client.ealert", &cfg); err != nil {
		panic(err)
	}

	cc, err := grpc2.NewClientConn(
		reg, grpc2.WithServiceName(cfg.Name), grpc2.WithClientJWTAuth(cfg.AuthToken), grpc2.WithDialOption(grpc.WithConnectParams(grpc.ConnectParams{
			MinConnectTimeout: 3 * time.Second,
		}), grpc.WithDefaultCallOptions(grpc.WaitForReady(false))),
	)
	if err != nil {
		panic(err)
	}

	return cc
}

// InitNotificationServiceClient 初始化 notification 服务客户端
func InitNotificationServiceClient(cc grpc.ClientConnInterface) notificationv1.NotificationServiceClient {
	return notificationv1.NewNotificationServiceClient(cc)
}

// InitTemplateServiceClient 初始化 template 服务客户端
func InitTemplateServiceClient(cc grpc.ClientConnInterface) templatev1.TemplateServiceClient {
	return templatev1.NewTemplateServiceClient(cc)
}
